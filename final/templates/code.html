<!DOCTYPE html>
<html lang="en">

<head>

    <link rel="icon" type="image/x-icon" href='{{url_for("static", filename = "favicon.ico")}}'>
    <title>Nutrition Nuts</title>


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script type="text/javascript" src='{{url_for("static", filename = "indexJs.js")}}'></script>
</head>

<body>

    <nav class="navbar navbar-light bg-light">
        <span class="navbar-brand mb-0 h1"><a href="results">Nutrition Nuts</a></span>
    </nav>


    <div class="jumbotron" style="background-color: #e8d0cf; padding-top: 20px; padding-bottom: 20px;">
        <h1 class="display-4" style="color : black; font-weight: bold; font-size: x-large">Check Out Our Code!</h1>
        <p class="lead" style="color: black; font-weight: bolder; font-size: large;">Click the links below to skip to a particular feature.</p>
    </div>

    <div class="row" style="margin-left: 100px;">
        <a id="heading">
            <h3><b>Code Snippets:</b></h3>
        </a>
    </div>

    <div class="row" style="margin-left: 100px;">
        <ul class="links">
            <li>
                <a href="#bar">Bar Chart</br></a>
            </li>
            <li>
                <a href="#nutrient-table">Nutrient Facts Table</br></a>
            </li>
            <li>
                <a href="#flask">Flask App</br></a>
            </li>
            <li>
                <a href="#model">Classification Model</a>
            </li>
        </ul>
    </div>
    <p>
        </br>
    </p>

    <div class="row" style="margin-left: 100px;">
        <a id="bar"><b>Bar Chart:</b></a>
    </div>

    <div class="row">
        <textarea id="bar-area" rows="25" cols="120" style="margin-left: 100px">
            <pre>
                &lt;/script&gt;
                    // bar chart 
                    var fruitsData = '../static/filtered_fruits.csv'
                        // var input = prediction;
                    var input = prediction;

                    // console log all the data
                    d3.csv(fruitsData).then(function(data) {
                        console.log(data);
                    });

                    // put all nutrient names in the dropdown menu
                    function dropdown() {
                        var dropDownMenu = d3.select('#selDataset');
                        d3.csv(fruitsData).then((data) => {
                            for (var i = 0; i < data.length; i++) {
                                var nutrient_names = data[i].Nutrient;
                                dropDownMenu.append('option').text(nutrient_names).property('value', nutrient_names)
                            }
                        })
                    }
                    // run the dropdown function
                    dropdown()

                    // BUILD CHART 
                    function buildChart(selected) {

                        d3.csv(fruitsData).then(function(data) {
                            var fruits = ['apple', 'banana', 'blueberry', 'fig', 'lemon', 'orange', 'peach', 'persimmon', 'tomato', 'watermelon'];

                            var colors = ['mistyrose', 'mistyrose', 'mistyrose', 'mistyrose',
                                'mistyrose', 'mistyrose', 'mistyrose', 'mistyrose',
                                'mistyrose', 'mistyrose'
                            ];

                            for (var j = 0; j < fruits.length; j++) {
                                if (input == fruits[j]) {
                                    colors[j] = 'darkred';
                                }
                                // console.log(input, colors)
                            }

                            for (var i = 0; i < data.length; i++) {
                                if (selected === data[i].Nutrient) {
                                    // console.log(selected);

                                    var yaxis = [data[i].Apple,
                                        data[i].Banana,
                                        data[i].Blueberries,
                                        data[i].Fig,
                                        data[i].Lemon,
                                        data[i].Orange,
                                        data[i].Peach,
                                        data[i].Persimmon_dried,
                                        data[i].Tomatoes,
                                        data[i].Watermelon
                                    ];
                                }
                                // console.log(yaxis)
                            }
                            var trace1 = {
                                x: fruits,
                                y: yaxis,
                                marker: {
                                    color: colors
                                },
                                type: 'bar',
                                orientation: 'v'
                            };

                            // data array
                            var data = [trace1];

                            // layout
                            var layout = {
                                title: '<b>Fruit Comparison</b>',
                                font: {
                                    family: 'Courier New, monospace',
                                    size: 18,
                                    color: 'rgb(17, 105, 9)'
                                },
                                xaxis: {
                                    title: 'Fruits'
                                },
                                yaxis: {
                                    title: 'Content'
                                }
                            };

                            // plot chart
                            Plotly.newPlot('bar', data, layout)
                        })
                    }

                    buildChart('Energy (kcal)');


                    // BUILD NEW CHART WITH EACH OPTION CHANGE 
                    function optionChange(newSelection) {
                        if (newSelection !== "") {
                            buildChart(newSelection)
                        } else {
                            var barChart = d3.select('#bar')
                            barChart.html("");
                        }
                    };
                &lt;/script&gt;
            </pre>
    </textarea>
    </div>



    <p>
        </br>
    </p>



    <div class="row" style="margin-left: 100px;">
        <a id="nutrient-table"><b>Nutrient Facts Table:</b></a>
    </div>

    <div class="row">
        <textarea id="table-area" rows="25" cols="120" style="margin-left: 100px;">
            <pre>
                &lt;script&gt;
                    var url = "../static/results_details.json"
                    console.log(url)
                    var csv = "../static/Daily-Values.csv"
                    console.log(prediction)
            
                    // Load json and csv files
                    d3.json(url).then((jsonData) => {
                        d3.csv(csv).then((daily) => {
                            // console.log(jsonData)
                            // console.log(daily)
            
                            // Access key value (fruit name) from App
                            text = prediction
                            selectedOption = text.toLowerCase()
                                // console.log(selectedOption)
            
                            // Filter fruit from jsonData
                            summary = jsonData.filter(d => d.description.toLowerCase() == selectedOption)
                                // console.log("summary", summary)
            
                            // Portions Data
                            fruitDesc = []
                            fruitWeight = []
                            for (var j = 0; j < summary.map(row => row.foodPortions)[0].length; j++) {
                                var portDesc = summary.map(row => row.foodPortions[j].portionDescription)
                                if (String(portDesc).includes("1 small")) {
                                    fruitDesc = summary.map(row => row.foodPortions[j].portionDescription)
                                    fruitWeight = summary.map(row => row.foodPortions[j].gramWeight)
                                    break;
                                } else {
                                    fruitDesc = summary.map(row => row.foodPortions[0].portionDescription)
                                    fruitWeight = summary.map(row => row.foodPortions[0].gramWeight)
                                }
                            }
                            // console.log(fruitDesc)
                            // console.log(fruitWeight)
            
                            // Base value of 100 g that the nutrition information uses
                            var baseWeight = 100
            
                            // Calculate the factor based off the serving size and base value
                            var fruitFactor = fruitWeight / baseWeight
                                // console.log(fruitFactor)
            
                            // Fruit name
                            var fruitName = summary.map(row => row.description)
            
                            // Energy
                            var calAmt = (summary.map(row => row.foodNutrients[3].amount) * fruitFactor).toFixed(2)
                            var calUnit = summary.map(row => row.foodNutrients[3].nutrient.unitName)
            
                            // Total lipid (fat)
                            var lipfatAmt = (summary.map(row => row.foodNutrients[1].amount) * fruitFactor).toFixed(2)
                            var lipfatUnit = summary.map(row => row.foodNutrients[1].nutrient.unitName)
                            var lipfatDVAdult = isNaN((lipfatAmt / daily[27].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (lipfatAmt / daily[27].Adults * 100).toFixed(1) + "%"
            
                            // Fatty acids, total saturated
                            var satfatAmt = (summary.map(row => row.foodNutrients[43].amount) * fruitFactor).toFixed(2)
                            var satfatUnit = summary.map(row => row.foodNutrients[43].nutrient.unitName)
                            var satfatDVAdult = isNaN((satfatAmt / daily[28].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (satfatAmt / daily[28].Adults * 100).toFixed(1) + "%"
            
                            // Cholesterol
                            var cholAmt = (summary.map(row => row.foodNutrients[42].amount) * fruitFactor).toFixed(2)
                            var cholUnit = summary.map(row => row.foodNutrients[42].nutrient.unitName)
                            var cholDVAdult = isNaN((cholAmt / daily[29].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (cholAmt / daily[29].Adults * 100).toFixed(1) + "%"
            
                            // Sodium, Na
                            var naAmt = (summary.map(row => row.foodNutrients[15].amount) * fruitFactor).toFixed(2)
                            var naUnit = summary.map(row => row.foodNutrients[15].nutrient.unitName)
                            var naDVAdult = isNaN((naAmt / daily[31].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (naAmt / daily[31].Adults * 100).toFixed(1) = "%"
            
                            // Carbohydrate, by difference
                            var carbAmt = (summary.map(row => row.foodNutrients[2].amount) * fruitFactor).toFixed(2)
                            var carbUnit = summary.map(row => row.foodNutrients[2].nutrient.unitName)
                            var carbDVAdult = isNaN((carbAmt / daily[30].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (carbAmt / daily[30].Adults * 100).toFixed(1) + "%"
            
                            // Fiber, total dietary
                            var fiberAmt = (summary.map(row => row.foodNutrients[9].amount) * fruitFactor).toFixed(2)
                            var fiberUnit = summary.map(row => row.foodNutrients[9].nutrient.unitName)
                            var fiberDVAdult = isNaN((fiberAmt / daily[32].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (fiberAmt / daily[32].Adults * 100).toFixed(1) + "%"
            
                            // Sugars, total including NLEA
                            var sugarAmt = (summary.map(row => row.foodNutrients[8].amount) * fruitFactor).toFixed(2)
                            var sugarUnit = summary.map(row => row.foodNutrients[8].nutrient.unitName)
                            var sugarDVAdult = isNaN((sugarAmt / daily[34].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (sugarAmt / daily[34].Adults * 100).toFixed(1) + "%"
            
                            // Protein
                            var proteinAmt = (summary.map(row => row.foodNutrients[0].amount) * fruitFactor).toFixed(2)
                            var proteinUnit = summary.map(row => row.foodNutrients[0].nutrient.unitName)
                            var proteinDVAdult = isNaN((proteinAmt / daily[33].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (proteinAmt / daily[33].Adults * 100).toFixed(1) + "%"
                            console.log(proteinDVAdult)
            
                            // Vitamin A, RAE
                            var vitAAmt = (summary.map(row => row.foodNutrients[20].amount) * fruitFactor).toFixed(2)
                            var vitAUnit = summary.map(row => row.foodNutrients[20].nutrient.unitName)
                            var vitAVAdult = isNaN((vitAAmt / daily[0].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (vitAAmt / daily[0].Adults * 100).toFixed(1) + "%"
            
                            // Vitamin B-6
                            var vitBAmt = (summary.map(row => row.foodNutrients[32].amount) * fruitFactor).toFixed(2)
                            var vitBUnit = summary.map(row => row.foodNutrients[32].nutrient.unitName)
                            var vitBDVAdult = isNaN((vitBAmt / daily[10].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (vitBAmt / daily[10].Adults * 100).toFixed(1) + "%"
            
                            // Vitamin C, total ascorbic acid
                            var vitCAmt = (summary.map(row => row.foodNutrients[28].amount) * fruitFactor).toFixed(2)
                            var vitCUnit = summary.map(row => row.foodNutrients[28].nutrient.unitName)
                            var vitCDVAdult = isNaN((vitCAmt / daily[1].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (vitCAmt / daily[1].Adults * 100).toFixed(1) + "%"
            
                            // Vitamin D (D2 + D3)
                            var vitDAmt = (summary.map(row => row.foodNutrients[24].amount) * fruitFactor).toFixed(2)
                            var vitDUnit = summary.map(row => row.foodNutrients[24].nutrient.unitName)
                            var vitDDVAdult = isNaN((vitDAmt / daily[4].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (vitDAmt / daily[4].Adults * 100).toFixed(1) + "%"
            
                            // Vitamin E (alpha-tocopherol)
                            var vitEAmt = (summary.map(row => row.foodNutrients[23].amount) * fruitFactor).toFixed(2)
                            var vitEUnit = summary.map(row => row.foodNutrients[23].nutrient.unitName)
                            var vitEDVAdult = isNaN((vitEAmt / daily[5].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (vitEAmt / daily[5].Adults * 100).toFixed(1) + "%"
            
                            // Calcium, Ca
                            var calciumAmt = (summary.map(row => row.foodNutrients[10].amount) * fruitFactor).toFixed(2)
                            var calciumUnit = summary.map(row => row.foodNutrients[10].nutrient.unitName)
                            var calciumDVAdult = isNaN((calciumAmt / daily[2].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (calciumAmt / daily[2].Adults * 100).toFixed(1) + "%"
            
                            // Iron, Fe
                            var ironAmt = (summary.map(row => row.foodNutrients[11].amount) * fruitFactor).toFixed(2)
                            var ironUnit = summary.map(row => row.foodNutrients[11].nutrient.unitName)
                            var ironDVAdult = isNaN((ironAmt / daily[3].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (ironAmt / daily[3].Adults * 100).toFixed(1) + "%"
            
                            // Potassium, K
                            var kAmt = (summary.map(row => row.foodNutrients[14].amount) * fruitFactor).toFixed(2)
                            var kUnit = summary.map(row => row.foodNutrients[14].nutrient.unitName)
                            var kDVAdult = isNaN((kAmt / daily[25].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (kAmt / daily[25].Adults * 100).toFixed(1) + "%"
            
                            // Magnesium, Mg
                            var mgAmt = (summary.map(row => row.foodNutrients[12].amount) * fruitFactor).toFixed(2)
                            var mgUnit = summary.map(row => row.foodNutrients[12].nutrient.unitName)
                            var mgDVAdult = isNaN((mgAmt / daily[17].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (mgAmt / daily[17].Adults * 100).toFixed(1) + "%"
            
                            // Phosphorus, P
                            var pAmt = (summary.map(row => row.foodNutrients[13].amount) * fruitFactor).toFixed(2)
                            var pUnit = summary.map(row => row.foodNutrients[13].nutrient.unitName)
                            var pDVAdult = isNaN((pAmt / daily[15].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (pAmt / daily[15].Adults * 100).toFixed(1) + "%"
            
                            // Zinc, Zn
                            var znAmt = (summary.map(row => row.foodNutrients[16].amount) * fruitFactor).toFixed(2)
                            var znUnit = summary.map(row => row.foodNutrients[16].nutrient.unitName)
                            var znDVAdult = isNaN((znAmt / daily[18].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (znAmt / daily[18].Adults * 100).toFixed(1) + "%"
            
                            // Copper, Cu
                            var cuAmt = (summary.map(row => row.foodNutrients[17].amount) * fruitFactor).toFixed(2)
                            var cuUnit = summary.map(row => row.foodNutrients[17].nutrient.unitName)
                            var cuDVAdult = isNaN((cuAmt / daily[20].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (cuAmt / daily[20].Adults * 100).toFixed(1) + "%"
            
                            // Carotene, beta
                            var bcAmt = (summary.map(row => row.foodNutrients[21].amount) * fruitFactor).toFixed(2)
                            var bcUnit = summary.map(row => row.foodNutrients[21].nutrient.unitName)
                            var bcDVAdult = "N/A"
            
                            // Thiamin
                            var thiaminAmt = (summary.map(row => row.foodNutrients[29].amount) * fruitFactor).toFixed(2)
                            var thiaminUnit = summary.map(row => row.foodNutrients[29].nutrient.unitName)
                            var thiaminDVAdult = isNaN((thiaminAmt / daily[7].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (thiaminAmt / daily[7].Adults * 100).toFixed(1) + "%"
            
                            // Riboflavin
                            var riboAmt = (summary.map(row => row.foodNutrients[30].amount) * fruitFactor).toFixed(2)
                            var riboUnit = summary.map(row => row.foodNutrients[30].nutrient.unitName)
                            var riboDVAdult = isNaN((riboAmt / daily[8].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (riboAmt / daily[8].Adults * 100).toFixed(1) + "%"
            
                            // Niacin
                            var niacinAmt = (summary.map(row => row.foodNutrients[31].amount) * fruitFactor).toFixed(2)
                            var niacinUnit = summary.map(row => row.foodNutrients[31].nutrient.unitName)
                            var niacinDVAdult = isNaN((niacinAmt / daily[9].Adults * 100).toFixed(1)) ? 0 + "." + 0 + "%" : (niacinAmt / daily[9].Adults * 100).toFixed(1) + "%"
            
                            // Fatty acids, total monounsaturated
                            var monofatAmt = (summary.map(row => row.foodNutrients[63].amount) * fruitFactor).toFixed(2)
                            var monofatUnit = summary.map(row => row.foodNutrients[63].nutrient.unitName)
                            var monofatDVAdult = "N/A"
            
                            // Fatty acids, total polyunsaturated
                            var polyfatAmt = (summary.map(row => row.foodNutrients[64].amount) * fruitFactor).toFixed(2)
                            var polyfatUnit = summary.map(row => row.foodNutrients[64].nutrient.unitName)
                            var polyfatDVAdult = "N/A"
            
                            // Water
                            var waterAmt = (summary.map(row => row.foodNutrients[5].amount) * fruitFactor).toFixed(2)
                            var waterUnit = summary.map(row => row.foodNutrients[5].nutrient.unitName)
                            var waterDVAdult = "N/A"
            
                            // Append to Table
                            var serve = d3.select("#heading-nutrition")
                            serve.html("")
                            serve.append().text(`Nutrition Facts: ${fruitName}`)
            
                            var serve = d3.select("#row-serve")
                            serve.html("")
                            serve.append().text(`Serving Size: ${fruitDesc} (${fruitWeight} g)`)
            
                            var serve = d3.select("#row-cal")
                            serve.html("")
                            serve.append().text(`Calories: ${calAmt} ${calUnit}`)
            
                            var cell = d3.select("#row-1")
                            cell.html("")
                            cell.append("td").text(`Total Fats`)
                            cell.append("td").text(`${lipfatAmt} ${lipfatUnit}`)
                            cell.append("td").text(`${lipfatDVAdult}`)
            
                            var cell = d3.select("#row-2")
                            cell.html("")
                            cell.append("td").text(`Saturated Fat`)
                            cell.append("td").text(`${satfatAmt} ${satfatUnit}`)
                            cell.append("td").text(`${satfatDVAdult}`)
            
                            var cell = d3.select("#row-3")
                            cell.html("")
                            cell.append("td").text(`Cholesterol`)
                            cell.append("td").text(`${cholAmt} ${cholUnit}`)
                            cell.append("td").text(`${cholDVAdult}`)
            
                            var cell = d3.select("#row-4")
                            cell.html("")
                            cell.append("td").text(`Sodium`)
                            cell.append("td").text(`${naAmt} ${naUnit}`)
                            cell.append("td").text(`${naDVAdult}`)
            
                            var cell = d3.select("#row-5")
                            cell.html("")
                            cell.append("td").text(`Total Carbohydrate`)
                            cell.append("td").text(`${carbAmt} ${carbUnit}`)
                            cell.append("td").text(`${carbDVAdult}`)
            
                            var cell = d3.select("#row-6")
                            cell.html("")
                            cell.append("td").text(`Dietary Fiber`)
                            cell.append("td").text(`${fiberAmt} ${fiberUnit}`)
                            cell.append("td").text(`${fiberDVAdult}`)
            
                            var cell = d3.select("#row-7")
                            cell.html("")
                            cell.append("td").text(`Sugars`)
                            cell.append("td").text(`${sugarAmt} ${sugarUnit}`)
                            cell.append("td").text(`${sugarDVAdult}`)
            
                            var cell = d3.select("#row-8")
                            cell.html("")
                            cell.append("td").text(`Protein`)
                            cell.append("td").text(`${satfatAmt} ${proteinUnit}`)
                            cell.append("td").text(`${satfatDVAdult}`)
            
                            var cell = d3.select("#row-9")
                            cell.html("")
                            cell.append("td").text(`Vitamin A`)
                            cell.append("td").text(`${vitAAmt} ${vitAUnit}`)
                            cell.append("td").text(`${vitAVAdult}`)
            
                            var cell = d3.select("#row-10")
                            cell.html("")
                            cell.append("td").text(`Vitamin B6`)
                            cell.append("td").text(`${vitBAmt} ${vitBUnit}`)
                            cell.append("td").text(`${vitBDVAdult}`)
            
                            var cell = d3.select("#row-11")
                            cell.html("")
                            cell.append("td").text(`Vitamin C`)
                            cell.append("td").text(`${vitCAmt} ${vitCUnit}`)
                            cell.append("td").text(`${vitCDVAdult}`)
            
                            var cell = d3.select("#row-12")
                            cell.html("")
                            cell.append("td").text(`Vitamin D`)
                            cell.append("td").text(`${vitDAmt} ${vitDUnit}`)
                            cell.append("td").text(`${vitDDVAdult}`)
            
                            var cell = d3.select("#row-13")
                            cell.html("")
                            cell.append("td").text(`Vitamin E`)
                            cell.append("td").text(`${vitEAmt} ${vitEUnit}`)
                            cell.append("td").text(`${vitEDVAdult}`)
            
                            var cell = d3.select("#row-14")
                            cell.html("")
                            cell.append("td").text(`Calcium`)
                            cell.append("td").text(`${calciumAmt} ${calciumUnit}`)
                            cell.append("td").text(`${calciumDVAdult}`)
            
                            var cell = d3.select("#row-15")
                            cell.html("")
                            cell.append("td").text(`Iron`)
                            cell.append("td").text(`${ironAmt} ${ironUnit}`)
                            cell.append("td").text(`${ironDVAdult}`)
            
                            var cell = d3.select("#row-16")
                            cell.html("")
                            cell.append("td").text(`Potassium`)
                            cell.append("td").text(`${kAmt} ${kUnit}`)
                            cell.append("td").text(`${kDVAdult}`)
            
                            var cell = d3.select("#row-17")
                            cell.html("")
                            cell.append("td").text(`Magnesium`)
                            cell.append("td").text(`${mgAmt} ${mgUnit}`)
                            cell.append("td").text(`${mgDVAdult}`)
            
                            var cell = d3.select("#row-18")
                            cell.html("")
                            cell.append("td").text(`Phosporus`)
                            cell.append("td").text(`${pAmt} ${pUnit}`)
                            cell.append("td").text(`${pDVAdult}`)
            
                            var cell = d3.select("#row-19")
                            cell.html("")
                            cell.append("td").text(`Zinc`)
                            cell.append("td").text(`${znAmt} ${znUnit}`)
                            cell.append("td").text(`${znDVAdult}`)
            
                            var cell = d3.select("#row-20")
                            cell.html("")
                            cell.append("td").text(`Copper`)
                            cell.append("td").text(`${cuAmt} ${cuUnit}`)
                            cell.append("td").text(`${cuDVAdult}`)
            
                            var cell = d3.select("#row-21")
                            cell.html("")
                            cell.append("td").text(`Beta Carotene`)
                            cell.append("td").text(`${bcAmt} ${bcUnit}`)
                            cell.append("td").text(`${bcDVAdult}`)
            
                            var cell = d3.select("#row-22")
                            cell.html("")
                            cell.append("td").text(`Thiamin`)
                            cell.append("td").text(`${thiaminAmt} ${thiaminUnit}`)
                            cell.append("td").text(`${thiaminDVAdult}`)
            
                            var cell = d3.select("#row-23")
                            cell.html("")
                            cell.append("td").text(`Riboflavin`)
                            cell.append("td").text(`${riboAmt} ${riboUnit}`)
                            cell.append("td").text(`${riboDVAdult}`)
            
                            var cell = d3.select("#row-24")
                            cell.html("")
                            cell.append("td").text(`Niacin`)
                            cell.append("td").text(`${niacinAmt} ${niacinUnit}`)
                            cell.append("td").text(`${niacinDVAdult}`)
            
                            var cell = d3.select("#row-25")
                            cell.html("")
                            cell.append("td").text(`Monounsaturated Fat`)
                            cell.append("td").text(`${monofatAmt} ${monofatUnit}`)
                            cell.append("td").text(`${monofatDVAdult}`)
            
                            var cell = d3.select("#row-26")
                            cell.html("")
                            cell.append("td").text(`Polyunsaturated Fat`)
                            cell.append("td").text(`${polyfatAmt} ${polyfatUnit}`)
                            cell.append("td").text(`${polyfatDVAdult}`)
            
                            var cell = d3.select("#row-27")
                            cell.html("")
                            cell.append("td").text(`Water`)
                            cell.append("td").text(`${waterAmt} ${waterUnit}`)
                            cell.append("td").text(`${waterDVAdult}`)
            
                        })
                    })
                &lt;/script&gt;
            </pre>
        </textarea>
    </div>



    <p>
        </br>
    </p>



    <div class="row" style="margin-left: 100px;">
        <a id="flask"><b>Flask App:</b></a>
    </div>

    <div class="row">
        <textarea id="flask-area" rows="25" cols="120" style="margin-left: 100px;">
            <pre>
                &lt;/script&gt;
                    from flask import Flask, jsonify, redirect, url_for, request, render_template, session
                    from flask_dropzone import Dropzone
                    from flask_uploads import UploadSet, configure_uploads, IMAGES, patch_request_class
                    
                    import os
                    
                                
                    import tkinter as tk
                    from tkinter import filedialog
                    from PIL import ImageTk, Image
                    import numpy
                    import tensorflow as tf
                    from tensorflow import keras
                    
                    #load the trained model to classify the images
                    from keras.models import load_model
                    
                    model = load_model('fruits_tensorflow-100-New10-360.h5')
                    
                    #dictionary to label all the dataset classes.
                    classes = { 
                        0:'apple',
                        1:'banana',
                        2:'blueberry',
                        3:'fig',
                        4:'lemon',
                        5:'orange',
                        6:'peach',
                        7:'persimmon',
                        8:'tomato',
                        9:'watermelon'
                    }
                    
                    def classify(file_path):
                        img = keras.preprocessing.image.load_img(
                            file_path, target_size=(180, 180))
                        img_array = keras.preprocessing.image.img_to_array(img)
                        img_array = tf.expand_dims(img_array, 0) # Create a batch
                    
                        predictions = model.predict_classes(img_array)[0]
                        sign = classes[predictions]
                        return sign
                    
                    
                    
                    ###################################################################################################################################################
                    ###FLASK APP#######################################################################################################################################
                    ###################################################################################################################################################
                    
                    
                    
                    app = Flask(__name__)
                    dropzone = Dropzone(app)
                    
                    app.config['SECRET_KEY'] = 'supersecretkey'
                    
                    
                    # Dropzone settings
                    # app.config['DROPZONE_UPLOAD_MULTIPLE'] = True
                    app.config['DROPZONE_ALLOWED_FILE_CUSTOM'] = True
                    app.config['DROPZONE_ALLOWED_FILE_TYPE'] = 'image/*'
                    app.config['DROPZONE_REDIRECT_VIEW'] = 'results'
                    # Uploads settings
                    app.config['UPLOADED_PHOTOS_DEST'] = os.getcwd() + '/uploads'
                    
                    photos = UploadSet('photos', IMAGES)
                    configure_uploads(app, photos)
                    patch_request_class(app)  # set maximum file size, default is 16MB
                    
                    
                    
                    @app.route("/", methods = ["GET", "POST"])
                    def index():
                    
                        sessionArguments = ['file_urls', 'prediction', 'prediction_data']
                        # sessionArguments = [ "file_urls","food_name", "food_type", "food_description", "energy", "water", "sugar", "vitamin_C", "calcium", "carbohydrate","protein", "sodium","vitamin_E", "cooper", "iron", "magnesium", "phosphorus", "potassium","zinc","total_fat", "saturated_fat", "fiber_total_dietary"]
                        
                        
                        for argument in sessionArguments:
                            if argument not in session:
                                session[argument] = []
                    
                        auxContainer = {'file_urls':[], 'prediction':[], 'prediction_data':[]}
                        for key in sessionArguments:
                            auxContainer[key] = session[key]
                    
                        # handle image upload from Dropzone
                        if request.method == "POST":
                            file_obj = request.files
                            for f in file_obj:
                                file = request.files.get(f)
                                
                                
                                filename = photos.save(file, name=file.filename)
                                path_image = f'./uploads/{filename}'
                                resultPrediction = classify(path_image)
                    
                                auxContainer['file_urls'].append(photos.url(filename))
                                auxContainer['prediction'].append(resultPrediction)
                                # auxContainer['prediction_data'].append(predictionData)
                            
                            session['file_urls'] = auxContainer['file_urls']
                            session['prediction'] = auxContainer['prediction']
                            
                            return "uploading..."
                    
                        # return dropzone template on GET request  
                        return render_template('index.html')
                    
                    @app.route('/results')
                    def results():
                        # redirect to home if no images to display
                        if "file_urls" not in session or session['file_urls'] == []:
                            return redirect(url_for('index'))
                            
                        # set the file_urls and remove the session variable
                        file_urls = session['file_urls']
                        session.pop('file_urls', None)
                        prediction = session['prediction']
                        session.pop('prediction', None)
                        prediction_data = session['prediction_data']
                        session.pop('prediction_data', None)
                    
                        print("##########################################")
                        print(prediction_data)
                        data = {'file_urls':file_urls, 'prediction': prediction, 'prediction_data': prediction_data}
                    
                        return render_template('results.html', data=data)

                    @app.route('/code')
                        def code():
                            
                        return render_template('code.html')
                    
                    if __name__ == "__main__":
                        app.run(debug=True)
                &lt;/script&gt;
            </pre>
        </textarea>
    </div>

    <p>
        </br>
    </p>



    <div class="row" style="margin-left: 100px;">
        <a id="model"><b>Classification Model:</b></a>
    </div>

    <div class="row">
        <textarea id="flask-area" rows="25" cols="120" style="margin-left: 100px;">
            <pre>
                &lt;/script&gt;
                    # Import TensorFlow and other libraries

                    import matplotlib.pyplot as plt
                    import numpy as np
                    import os
                    import PIL
                    import tensorflow as tf
                    
                    from tensorflow import keras
                    from tensorflow.keras import layers
                    from tensorflow.keras.models import Sequential
                    
                    # Define the pathway to the dataset
                    data_root = ("D:/Downloads/UCI Data Analytics/Class/Project_Final/fruits10")
                    
                    # List data path with pathlib
                    import pathlib
                    data_dir = pathlib.Path(data_root)
                    
                    # Count the number of images in the dataset
                    image_count = len(list(data_dir.glob('*/*.jpg')))
                    print(image_count)
                    
                    # Run anthoer example
                    PIL.Image.open(str(orange[1]))
                    
                    **Load using keras.preprocessing**
                    ---
                    Create a dataset
                    
                    # Define parameters for the loader
                    batch_size = 32
                    img_height = 180
                    img_width = 180
                    
                    # Split training dataset to 80% and validation to 20%
                    train_ds = tf.keras.preprocessing.image_dataset_from_directory(
                    data_dir,
                    validation_split=0.2,
                    subset="training",
                    seed=123,
                    image_size=(img_height, img_width),
                    batch_size=batch_size)
                    
                    # Define validation dataset to 20% of the images
                    val_ds = tf.keras.preprocessing.image_dataset_from_directory(
                    data_dir,
                    validation_split=0.2,
                    subset="validation",
                    seed=123,
                    image_size=(img_height, img_width),
                    batch_size=batch_size)
                    
                    # List the class names
                    class_names = train_ds.class_names
                    print(class_names)
                    
                    **Visualizing the Data**
                    
                    # Plot the first 9 images from the training dataset
                    import matplotlib.pyplot as plt
                    
                    plt.figure(figsize=(10, 10))
                    for images, labels in train_ds.take(1):
                    for i in range(9):
                        ax = plt.subplot(3, 3, i + 1)
                        plt.imshow(images[i].numpy().astype("uint8"))
                        plt.title(class_names[labels[i]])
                        plt.axis("off")
                    
                        # Manually iterate over the dataset and retrieve batches of images
                    for image_batch, labels_batch in train_ds:
                    print(image_batch.shape)
                    print(labels_batch.shape)
                    break
                    
                    **Configure the dataset for performance**
                    
                    # Cache the image for easier loading after first epoch
                    AUTOTUNE = tf.data.experimental.AUTOTUNE
                    
                    train_ds = train_ds.cache().shuffle(1000).prefetch(buffer_size=AUTOTUNE)
                    val_ds = val_ds.cache().prefetch(buffer_size=AUTOTUNE)
                    
                    **Standardize the data**
                    
                    # Standardize the layer to [0,1]
                    normalization_layer = layers.experimental.preprocessing.Rescaling(1./255)
                    
                    # Apply to dataset by calling map (will take time)
                    normalized_ds = train_ds.map(lambda x, y: (normalization_layer(x), y))
                    image_batch, labels_batch = next(iter(normalized_ds))
                    first_image = image_batch[0]
                    # Notice the pixels values are now in `[0,1]`.
                    print(np.min(first_image), np.max(first_image)) 
                    
                    **Create the Model**
                    
                    # List the number of classes (***change accordingly***)
                    num_classes = len(list(class_names))
                    
                    model = Sequential([
                    layers.experimental.preprocessing.Rescaling(1./255, input_shape=(img_height, img_width, 3)),
                    layers.Conv2D(16, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Conv2D(32, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Conv2D(64, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Flatten(),
                    layers.Dense(128, activation='relu'),
                    layers.Dense(num_classes)
                    ])
                    
                    **Data Augmentation**
                    ---
                    [Experimental Keras Preprocessing Layers](https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/?version=nightly)
                    
                    # Generate additional training data from existing data for better accuracy
                    data_augmentation = keras.Sequential(
                    [
                        layers.experimental.preprocessing.RandomFlip("horizontal", 
                                                                    input_shape=(img_height, 
                                                                                img_width,
                                                                                3)),
                        layers.experimental.preprocessing.RandomRotation(0.1),
                        layers.experimental.preprocessing.RandomZoom(0.1),
                    ]
                    )
                    
                    # Visualize some of the data from data augmentation
                    plt.figure(figsize=(10, 10))
                    for images, _ in train_ds.take(1):
                    for i in range(9):
                        augmented_images = data_augmentation(images)
                        ax = plt.subplot(3, 3, i + 1)
                        plt.imshow(augmented_images[0].numpy().astype("uint8"))
                        plt.axis("off")
                    
                    **Dropout**
                    ---
                    To regulate
                    
                    # Create neural network
                    model = Sequential([
                    data_augmentation,
                    layers.experimental.preprocessing.Rescaling(1./255),
                    layers.Conv2D(16, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Conv2D(32, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Conv2D(64, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Dropout(0.2),
                    layers.Flatten(),
                    layers.Dense(128, activation='relu'),
                    layers.Dense(num_classes)
                    ])
                    
                    **Compile and Train**
                    
                    # Compile the model using the "adam" optimizer
                    model.compile(optimizer='adam',
                                loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),
                                metrics=['accuracy'])
                    
                    # List the model summary
                    model.summary()
                    
                    # Run and train the model (takes a very long time)
                    epochs=100
                    history = model.fit(
                    train_ds,
                    validation_data=val_ds,
                    epochs=epochs
                    )
                    
                    **Visualize training results**
                    
                    # Plot the results of Training versus Validation
                    acc = history.history['accuracy']
                    val_acc = history.history['val_accuracy']
                    
                    loss=history.history['loss']
                    val_loss=history.history['val_loss']
                    
                    epochs_range = range(epochs)
                    
                    plt.figure(figsize=(8, 8))
                    plt.subplot(1, 2, 1)
                    plt.plot(epochs_range, acc, label='Training Accuracy')
                    plt.plot(epochs_range, val_acc, label='Validation Accuracy')
                    plt.legend(loc='lower right')
                    plt.title('Training and Validation Accuracy')
                    
                    plt.subplot(1, 2, 2)
                    plt.plot(epochs_range, loss, label='Training Loss')
                    plt.plot(epochs_range, val_loss, label='Validation Loss')
                    plt.legend(loc='upper right')
                    plt.title('Training and Validation Loss')
                    plt.show()
                    
                    **Data Augmentation**
                    ---
                    [Experimental Keras Preprocessing Layers](https://www.tensorflow.org/api_docs/python/tf/keras/layers/experimental/preprocessing/?version=nightly)
                    
                    # Generate additional training data from existing data for better accuracy
                    data_augmentation = keras.Sequential(
                    [
                        layers.experimental.preprocessing.RandomFlip("horizontal", 
                                                                    input_shape=(img_height, 
                                                                                img_width,
                                                                                3)),
                        layers.experimental.preprocessing.RandomRotation(0.1),
                        layers.experimental.preprocessing.RandomZoom(0.1),
                    ]
                    )
                    
                    # Visualize some of the data from data augmentation
                    plt.figure(figsize=(10, 10))
                    for images, _ in train_ds.take(1):
                    for i in range(9):
                        augmented_images = data_augmentation(images)
                        ax = plt.subplot(3, 3, i + 1)
                        plt.imshow(augmented_images[0].numpy().astype("uint8"))
                        plt.axis("off")
                    
                    **Dropout**
                    ---
                    To regulate
                    
                    # Create neural network
                    model = Sequential([
                    data_augmentation,
                    layers.experimental.preprocessing.Rescaling(1./255),
                    layers.Conv2D(16, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Conv2D(32, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Conv2D(64, 3, padding='same', activation='relu'),
                    layers.MaxPooling2D(),
                    layers.Dropout(0.2),
                    layers.Flatten(),
                    layers.Dense(128, activation='relu'),
                    layers.Dense(num_classes)
                    ])
                    
                    **Compile and Train**
                    
                    # Compile the model using the "adam" optimizer
                    model.compile(optimizer='adam',
                                loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),
                                metrics=['accuracy'])
                    
                    # List the model summary
                    model.summary()
                    
                    # Run and train the model (takes a very long time)
                    epochs=100
                    history = model.fit(
                    train_ds,
                    validation_data=val_ds,
                    epochs=epochs
                    )
                    
                    **Predict on New Data**
                    
                    # Test out by entering an image link for a fruit and changing the file name to the fruit
                    image_url = "http://bulknaturalfoods.com/wp-content/uploads/2012/03/Red-Delicious-2.jpg"
                    image_path = tf.keras.utils.get_file('apple', origin=image_url)
                    
                    img = keras.preprocessing.image.load_img(
                        image_path, target_size=(img_height, img_width)
                    )
                    img_array = keras.preprocessing.image.img_to_array(img)
                    img_array = tf.expand_dims(img_array, 0) # Create a batch
                    
                    predictions = model.predict(img_array)
                    score = tf.nn.softmax(predictions[0])
                    
                    print(
                        "This image most likely belongs to {} with a {:.2f} percent confidence."
                        .format(class_names[np.argmax(score)], 100 * np.max(score))
                    )
                    
                    # Save the model
                    model.save("fruits_tensorflow-100-New10.h5")
                    
                    my_model = keras.models.load_model('D:/Downloads/UCI Data Analytics/Class/Project_Final/fruits_tensorflow-100-New10-360.h5')
                    
                    np.testing.assert_allclose(
                        model.predict(train_ds), my_model.predict(train_ds)
                    )
                &lt;/script&gt;
            </pre>
        </textarea>
    </div>

    <div class="row" style="margin-left: 650px;">
        <a href="#heading">Return to Top</a>
    </div>